<h2>Calendario Prenotazioni</h2>

@if (loading) {
  <div class="loader-container">
    <div class="spinner"></div>
    <p>Caricamento offerte in corso...</p>
  </div>
} @else {

  <!-- FullCalendar -->
  <full-calendar [options]="calendarOptions"></full-calendar>

  <!-- Lista prenotazioni filtrate per il giorno selezionato -->
  @if (selectedDate && selectedPrenotazioni.length > 0) {
    <h3>Prenotazioni per il {{ selectedDate | date:'dd/MM/yyyy' }}</h3>

    @for (prenotazione of selectedPrenotazioni; track prenotazione) {
      <div class="prenotazioni-card">

        <div class="prenotazioni-header">
          <div>
            <a class="indirizzo" [routerLink]="['/dettagli-immobile', prenotazione?.immobile?.id]">
              {{ prenotazione?.immobile?.indirizzo?.via }}, 
              {{ prenotazione?.immobile?.indirizzo?.citta }}, 
              {{ prenotazione?.immobile?.indirizzo?.provincia }}
            </a>

            <p class="data-visita">
              ðŸ“… ORARIO VISITA: {{ prenotazione?.dataOra | date:'HH:mm' }}
            </p>
          </div>

          <span class="stato"
                [ngClass]="{
                  'stato-attesa': prenotazione?.stato === 'RICHIESTA',
                  'stato-accettata': prenotazione?.stato === 'CONFERMATA'
                }">
            {{ prenotazione?.stato === 'RICHIESTA' ? 'In attesa di conferma' : prenotazione?.stato }}
          </span>
        </div>

        <div class="prenotazioni-body">
          <div class="cliente-box">
            <h4>I tuoi contatti</h4>
            <p>Email: {{ agenteData?.email }}</p>
            <p>Telefono: {{ agenteData?.numeroTelefonico }}</p>
          </div>

          <div class="agente-box">
            <h4>Contatti Cliente</h4>
            <p>Nome e cognome: {{ prenotazione?.clienteData?.nome ?? '-' }}</p>
            <p>Email: {{ prenotazione?.clienteData?.email ?? '-' }}</p>
            <p>Telefono: {{ prenotazione?.clienteData?.numeroTelefonico ?? '-' }}</p>
          </div>
        </div>

        <div class="prenotazioni-footer">
          <div class="data">
            ðŸ“… Richiesta il: {{ prenotazione?.creataIl | date:'dd/MM/yyyy HH:mm' }}
          </div>

          @if (prenotazione?.stato === 'RICHIESTA') {
            <div class="actions">
              <button class="tab action-accept" (click)="accetta(prenotazione?.id)">
                Accetta
              </button>

              <button class="tab action-reject" (click)="rifiuta(prenotazione?.id)">
                Rifiuta
              </button>
            </div>
          }
        </div>

      </div>
    }
  } @else if (selectedDate && selectedPrenotazioni.length === 0) {
    <p>Nessuna prenotazione per questo giorno.</p>
  }
}
