<div class="search-offerts">
  <button
    role="tab"
    type="button"
    (click)="offerteInAttesa()"
    class="tab Attesa"
    [attr.aria-selected]="selected === 'attesa'"
    [class.selected]="selected === 'attesa'">
    Offerte In Attesa
  </button>

  <button
    role="tab"
    type="button"
    (click)="offerteAccettate()"
    class="tab Accettate"
    [attr.aria-selected]="selected === 'accettate'"
    [class.selected]="selected === 'accettate'">
    Offerte Accettate
  </button>
</div>

@if (loading) {
  <div class="loader-container">
    <div class="spinner"></div>
    <p>Caricamento offerte in corso...</p>
  </div>
} @else {

  @for(immobile of ImmobiliList; track immobile) {

    
  @if(ImmobiliList.length === 0){
    <div class="empty-state">
      <p>Qui verranno mostrate le offerte ricevute</p>
    </div>
  }

    @if((this.selected === 'attesa' && statoImmobile(immobile) === 'attesa' ) || (this.selected === 'accettate' && statoImmobile(immobile) === 'accettata')){
        <div class="immobile-card">
      <h2 class="indirizzo-immobile">
        <a [routerLink]="['/dettagli-immobile', immobile.id]">{{ immobile.indirizzo.via }}, {{ immobile.indirizzo.citta }} ({{ immobile.indirizzo.provincia }})</a>
        
      </h2>

      <div class="offerte-container">
        @for(offerta of immobile.offerte; track offerta) {
          <div class="offerta-card" [class.disabilitata]="offerta.disabilitata">
            <div class="offerta-inner">
              <div class="offerta-info">
                <p><strong>Nome:</strong> {{offerta.nomeOfferente}}</p>
                <p><strong>Cognome:</strong> {{offerta.cognomeOfferente}}</p>
                <p><strong>Telefono:</strong> {{offerta.telefono}}</p>
                <p><strong>Email:</strong> {{offerta.emailOfferente}}</p>
              </div>

              <div class="offerta-body">
                <div class="offerta-box">
                  Offerta: â‚¬{{ offerta.cifraOfferta | number:'1.0-0' }}
                </div>
              </div>
            </div>

            <div class="data">
              ðŸ“… {{ offerta.dataOfferta | date:'dd/MM/yyyy HH:mm' }}
            </div>

            <div class="azioni">
              <button class="btn-accetta" (click)="accetta(offerta.offertaId); $event.stopPropagation()">Accetta</button>
              <button class="btn-rifiuta" (click)="apriPopupRifiuto(offerta.offertaId); $event.stopPropagation()">Rifiuta</button>
            </div>
          </div>
        }
      </div>
    </div>
    }
    
  }

  
  @if (mostraPopup) {
    <div class="overlay">
      <div class="popup">
        @if (statoPopup === 'chiedi') {
          <h3>Vuoi fare una controproposta?</h3>
          <div class="popup-actions">
            <button class="btn-secondary" (click)="confermaRifiuto()">No</button>
            <button class="btn-primary" (click)="vaiAControproposta()">SÃ¬</button>
          </div>
        }

        @if (statoPopup === 'controproposta') {
          <h3>Inserisci la controproposta</h3>
          <input type="number" placeholder="Importo (â‚¬)" [(ngModel)]="controproposta" />
          <div class="popup-actions">
            <button class="btn-secondary" (click)="tornaAllaDomanda()">Indietro</button>
            <button class="btn-primary" [disabled]="controproposta <= 0" (click)="inviaControproposta()">Invia</button>
          </div>
        }

        @if (statoPopup === 'successo') {
          <h3>âœ… Controproposta inviata</h3>
          <p>La controproposta Ã¨ stata inviata con successo.</p>
          <div class="popup-actions">
            <button class="btn-primary" (click)="chiudiPopup()">OK</button>
          </div>
        }
      </div>
    </div>
  }

}
